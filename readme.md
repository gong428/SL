# AI μ½”λ”© μ–΄μ‹μ¤ν„΄νΈ ν”„λ΅μ νΈ

**κ³ μ„±λ¥ AI μ½”λ”© μ–΄μ‹μ¤ν„΄νΈ RAG(κ²€μƒ‰ μ¦κ°• μƒμ„±) μ‹μ¤ν…**

μ΄ ν”„λ΅μ νΈλ” Triton Inference Serverλ¥Ό ν†µν•΄ κ³ μ„±λ¥ LLMμ„ μ„λΉ™ν•κ³ , FastAPIμ™€ LangChainμ„ κΈ°λ°μΌλ΅ κµ¬μ¶•λ μ§€λ¥ν• RAG νμ΄ν”„λΌμΈμ„ ν†µν•΄ μ½”λ“λ² μ΄μ¤μ— λ€ν• μ§λ¬Έμ— λ‹µλ³€ν•λ” AI μ½”λ”© μ–΄μ‹μ¤ν„΄νΈμ…λ‹λ‹¤.

## β¨ μ£Όμ” κΈ°λ¥

* **κ³ μ„±λ¥ LLM μ„λΉ™**: NVIDIA Triton Inference Serverμ™€ vLLM/TensorRT-LLM λ°±μ—”λ“λ¥Ό μ‚¬μ©ν•μ—¬ λ€κ·λ¨ μ–Έμ–΄ λ¨λΈμ„ ν¨μ¨μ μΌλ΅ μ„λΉ™ν•©λ‹λ‹¤.
* **μ§€λ¥ν• μ½”λ“ λ¶„μ„**: `tree-sitter`λ¥Ό ν™μ©ν• AST(μ¶”μƒ κµ¬λ¬Έ νΈλ¦¬) κΈ°λ° μ½”λ“ λ¶„ν• λ΅ μ½”λ“μ μλ―Έλ΅ μ  λ‹¨μ„λ¥Ό μ •ν™•ν•κ² νμ•…ν•©λ‹λ‹¤.
* **κ³„μΈµμ  RAG (RAPTOR)**: Naive RAGλ¥Ό λ„μ–΄, μ½”λ“μ μ„Έλ¶€ λ‚΄μ©κ³Ό μ „μ²΄μ μΈ λ§¥λ½μ„ λ¨λ‘ μ΄ν•΄ν•λ” RAPTOR μ•„ν‚¤ν…μ²λ¥Ό μ μ©ν•μ—¬ κ²€μƒ‰ μ •ν™•λ„λ¥Ό κ·Ήλ€ν™”ν•©λ‹λ‹¤.
* **λ¨λ“μ‹ νμ΄ν”„λΌμΈ**: κ²€μƒ‰, ν”„λ΅¬ν”„νΈ κµ¬μ„±, μ¶”λ΅  μ”μ²­ λ“± κ° λ‹¨κ³„κ°€ λ…ν™•ν λ¶„λ¦¬λ νμ΄ν”„λΌμΈμΌλ΅ μ μ§€λ³΄μμ™€ ν™•μ¥μ΄ μ©μ΄ν•©λ‹λ‹¤.
* **μ μ—°ν• κ²€μƒ‰ μ „λµ**: `Naive`, `RAPTOR (μ²κ³Ό λ‚λ¬΄)`, `RAPTOR (μ¤μ½”ν”„ κ²€μƒ‰)` λ“± λ‹¤μ–‘ν• RAG κ²€μƒ‰ μ „λµμ„ API μ”μ²­ μ‹ μ„ νƒμ μΌλ΅ μ‚¬μ©ν•  μ μμµλ‹λ‹¤.

## π“‚ ν”„λ΅μ νΈ λ””λ ‰ν† λ¦¬ κµ¬μ΅°

```
SLproject/
β”β”€β”€ server/
β”‚   β”β”€β”€ run.sh                  # Triton μ¶”λ΅  μ„λ²„ μ‹¤ν–‰ μ¤ν¬λ¦½νΈ
β”‚   β””β”€β”€ models/                 # Triton λ¨λΈ λ¦¬ν¬μ§€ν† λ¦¬
β”‚       β””β”€β”€ Nxcode/
β”‚           β”β”€β”€ config.pbtxt
β”‚           β””β”€β”€ 1/
β”‚               β””β”€β”€ model.json
β”‚
β””β”€β”€ client/
β”β”€β”€ app/                    # FastAPI μ›Ή μ• ν”λ¦¬μΌ€μ΄μ…
β”‚   β”β”€β”€ main.py
β”‚   β””β”€β”€ router/
β”‚       β””β”€β”€ chat.py
β”β”€β”€ core/                   # ν•µμ‹¬ λΉ„μ¦λ‹μ¤ λ΅μ§ (νμ΄ν”„λΌμΈ, RAG μ»΄ν¬λ„νΈ)
β”‚   β””β”€β”€ ...
β”β”€β”€ scripts/
β”‚   β””β”€β”€ ingest.py           # RAG λ°μ΄ν„°λ² μ΄μ¤ μƒμ„± μ¤ν¬λ¦½νΈ
β”β”€β”€ vector_stores/          # μƒμ„±λ λ²΅ν„° DB μ €μ¥ μ„μΉ
β”β”€β”€ test/                   # μΈλ±μ‹± ν…μ¤νΈμ© μƒν” μ½”λ“
β””β”€β”€ requirements.txt        # Python μμ΅΄μ„± ν¨ν‚¤μ§€
```

## π€ μ„¤μΉ λ° μ‹¤ν–‰ κ°€μ΄λ“

μ΄ μ‹μ¤ν…μ€ **1) μ¶”λ΅  μ„λ²„**μ™€ **2) ν΄λΌμ΄μ–ΈνΈ μ„λ²„** λ‘ λ¶€λ¶„μΌλ΅ λ‚λ‰μ–΄ μ‹¤ν–‰λ©λ‹λ‹¤.

 ### 1. μ¶”λ΅  μ„λ²„ (Triton) κµ¬λ™ λ°©λ²•

μ¶”λ΅  μ„λ²„λ” Docker μ»¨ν…μ΄λ„λ΅ μ‹¤ν–‰λ©λ‹λ‹¤.

1.  **λ¨λΈ λ¦¬ν¬μ§€ν† λ¦¬ κµ¬μ„±**:
    `server/models/` λ””λ ‰ν† λ¦¬ μ•„λμ— μ‚¬μ©ν•  LLM λ¨λΈμ μ„¤μ •μ„ κµ¬μ„±ν•©λ‹λ‹¤. (`config.pbtxt`, `model.json`)

2.  **μ‹¤ν–‰ μ¤ν¬λ¦½νΈ κ¶ν• λ¶€μ—¬**:
    ν„°λ―Έλ„μ„ μ—΄κ³  `server` λ””λ ‰ν† λ¦¬λ΅ μ΄λ™ν•μ—¬ `run.sh` μ¤ν¬λ¦½νΈμ— μ‹¤ν–‰ κ¶ν•μ„ λ¶€μ—¬ν•©λ‹λ‹¤. (μµμ΄ ν• λ²λ§)
    ```bash
    cd server/
    chmod +x run.sh
    ```

3.  **μ„λ²„ μ‹¤ν–‰**:
    μ¤ν¬λ¦½νΈλ¥Ό μ‹¤ν–‰ν•μ—¬ Triton μ„λ²„ μ»¨ν…μ΄λ„λ¥Ό μ‹μ‘ν•©λ‹λ‹¤.
    ```bash
    ./run.sh
    ```
    μ„λ²„κ°€ μ •μƒμ μΌλ΅ μ‹¤ν–‰λλ©΄ GPUμ— λ¨λΈμ΄ λ΅λ“λκ³  μ”μ²­μ„ λ°›μ„ μ¤€λΉ„κ°€ μ™„λ£λ©λ‹λ‹¤.

 ### 2. ν΄λΌμ΄μ–ΈνΈ μ„λ²„ (FastAPI) κµ¬λ™ λ°©λ²•

ν΄λΌμ΄μ–ΈνΈ μ„λ²„λ” RAG νμ΄ν”„λΌμΈκ³Ό APIλ¥Ό λ‹΄λ‹Ήν•λ©°, Python κ°€μƒν™κ²½μ—μ„ μ‹¤ν–‰λ©λ‹λ‹¤.

1.  **`client` λ””λ ‰ν† λ¦¬λ΅ μ΄λ™**:
    μƒλ΅μ΄ ν„°λ―Έλ„μ„ μ—΄κ³  `client` λ””λ ‰ν† λ¦¬λ΅ μ΄λ™ν•©λ‹λ‹¤.
    ```bash
    cd client/
    ```

2.  **κ°€μƒν™κ²½ μƒμ„± λ° ν™μ„±ν™”**:
    ```bash
    conda create -n sl_assistant python=3.10
    conda activate sl_assistant
    ```
 

3.  **ν•„μ” ν¨ν‚¤μ§€ μ„¤μΉ**:
    `requirements.txt` νμΌμ— λ…μ‹λ λ¨λ“  Python λΌμ΄λΈλ¬λ¦¬λ¥Ό μ„¤μΉν•©λ‹λ‹¤.
    ```bash
    pip install -r requirements.txt
    ```

4.  **RAG λ°μ΄ν„°λ² μ΄μ¤ μƒμ„±**:
    ν΄λΌμ΄μ–ΈνΈ μ„λ²„λ¥Ό μ‹¤ν–‰ν•κΈ° μ „μ—, RAGκ°€ μ°Έμ΅°ν•  λ²΅ν„° λ°μ΄ν„°λ² μ΄μ¤λ¥Ό λ¨Όμ € μƒμ„±ν•΄μ•Ό ν•©λ‹λ‹¤. `scripts/ingest.py` μ¤ν¬λ¦½νΈλ¥Ό μ‹¤ν–‰ν•©λ‹λ‹¤.
    ```bash
    # python -m μµμ…μ„ μ‚¬μ©ν•μ—¬ ν”„λ΅μ νΈ λ£¨νΈμ—μ„ λ¨λ“λ΅ μ‹¤ν–‰
    python -m scripts.ingest
    ```
    μ΄ μ¤ν¬λ¦½νΈλ” `test/` ν΄λ”μ μ½”λ“λ¥Ό μ½μ–΄ `vector_stores/` λ””λ ‰ν† λ¦¬ μ•μ— `naive_db`μ™€ `raptor_db`λ¥Ό μƒμ„±ν•©λ‹λ‹¤.

5.  **ν΄λΌμ΄μ–ΈνΈ μ„λ²„ μ‹¤ν–‰**:
    Uvicornμ„ μ‚¬μ©ν•μ—¬ FastAPI μ• ν”λ¦¬μΌ€μ΄μ… μ„λ²„λ¥Ό μ‹μ‘ν•©λ‹λ‹¤.
    ```bash
    uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload
    ```
    μ„λ²„κ°€ `http://localhost:8000`μ—μ„ μ‹¤ν–‰λ©λ‹λ‹¤.

---
## π“– μ‚¬μ© λ°©λ²•

ν΄λΌμ΄μ–ΈνΈ μ„λ²„κ°€ μ‹¤ν–‰λλ©΄, `/api/v1/chat` μ—”λ“ν¬μΈνΈλ¥Ό ν†µν•΄ μ½”λ”© μ–΄μ‹μ¤ν„΄νΈ κΈ°λ¥μ„ μ‚¬μ©ν•  μ μμµλ‹λ‹¤.

### 1. λ€ν™”ν• API λ¬Έμ„ (Swagger UI) μ‚¬μ©

1.  μ›Ή λΈλΌμ°μ €μ—μ„ **`http://localhost:8000/docs`** λ΅ μ ‘μ†ν•©λ‹λ‹¤.
2.  `POST /api/v1/chat` μ—”λ“ν¬μΈνΈλ¥Ό μ—΄κ³  `Try it out` λ²„νΌμ„ ν΄λ¦­ν•©λ‹λ‹¤.
3.  `Request body`μ— μ›ν•λ” μ§λ¬Έ(`user_prompt`)κ³Ό RAG μ „λµ(`rag_strategy`)μ„ μ…λ ¥ν•κ³  `Execute` λ²„νΌμ„ λλ¬ κ²°κ³Όλ¥Ό ν™•μΈν•©λ‹λ‹¤.

### 2. `curl`μ„ μ΄μ©ν• μ§μ ‘ νΈμ¶

ν„°λ―Έλ„μ—μ„ `curl`μ„ μ‚¬μ©ν•μ—¬ APIλ¥Ό μ§μ ‘ νΈμ¶ν•  μλ„ μμµλ‹λ‹¤.

```bash
curl -X 'POST' \
  'http://localhost:8000/api/v1/chat' \
  -H 'Content-Type: application/json' \
  -d '{
    "user_prompt": "Explain the difference between the C++ and Python versions of the accelerate function.",
    "rag_strategy": "raptor_scoped"
  }'